 Wifi NetworkManager | Variscite Wiki document.documentElement.className="client-js";RLCONF={"wgBreakFrames":!1,"wgSeparatorTransformTable":\["",""\],"wgDigitTransformTable":\["",""\],"wgDefaultDateFormat":"dmy","wgMonthNames":\["","January","February","March","April","May","June","July","August","September","October","November","December"\],"wgRequestId":"972b86e73c83d5693dfb1e22","wgCSPNonce":!1,"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"Wifi\_NetworkManager","wgTitle":"Wifi NetworkManager","wgCurRevisionId":19479,"wgRevisionId":19479,"wgArticleId":769,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":\["\*"\],"wgCategories":\["Yocto","Debian","DART-MX8M","DART-MX8M-MINI","DART-MX8M-PLUS"\],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Wifi\_NetworkManager","wgRelevantArticleId":769,"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,"wgRestrictionEdit":\[\],"wgRestrictionMove":\[\], "wgMediaViewerOnClick":!0,"wgMediaViewerEnabledByDefault":!0,"wgVisualEditor":{"pageLanguageCode":"en","pageLanguageDir":"ltr","pageVariantFallbacks":"en"},"wgEditSubmitButtonLabelPublish":!1};RLSTATE={"ext.gadget.Mainpage-notitle":"ready","site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","ext.pygments":"ready","ext.pageNotice":"ready","mediawiki.ui.button":"ready","skins.chameleon":"ready","zzz.ext.bootstrap.styles":"ready","mediawiki.toc.styles":"ready","ext.visualEditor.desktopArticleTarget.noscript":"ready"};RLPAGEMODULES=\["site","mediawiki.page.startup","mediawiki.page.ready","mediawiki.toc","ext.visualEditor.desktopArticleTarget.init","ext.visualEditor.targetLoader","ext.bootstrap.scripts"\]; (RLQ=window.RLQ||\[\]).push(function(){mw.loader.implement("user.options@1hzgi",function($,jQuery,require,module){/\*@nomin\*/mw.user.tokens.set({"patrolToken":"+\\\\","watchToken":"+\\\\","csrfToken":"+\\\\"}); });});               (function(w,d,s,l,i){w\[l\]=w\[l\]||\[\];w\[l\].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)\[0\], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-T6QZGK5');                           {"@context":"http:\\/\\/schema.org","@type":"article","name":"Wifi NetworkManager | Variscite Wiki","headline":"Wifi NetworkManager | Variscite Wiki","mainEntityOfPage":"Wifi NetworkManager","identifier":"https:\\/\\/variwiki.com\\/index.php?title=Wifi\_NetworkManager","url":"https:\\/\\/variwiki.com\\/index.php?title=Wifi\_NetworkManager","description":"Read the Wireless guide or browse Variscite's excellent knowledge base for more how-to guides related to Variscite's System on Module \\/ Computer on Module.","dateModified":"2022-03-01T18:10:51Z","datePublished":"2022-03-01T18:10:51Z","image":{"@type":"ImageObject","url":"https:\\/\\/variwiki.com\\/resources\\/assets\\/wiki.png"},"author":{"@type":"Organization","name":"Variscite Wiki","url":"https:\\/\\/variwiki.com","logo":{"@type":"ImageObject","url":"https:\\/\\/variwiki.com\\/resources\\/assets\\/wiki.png","caption":"Variscite Wiki"}},"publisher":{"@type":"Organization","name":"Variscite Wiki","url":"https:\\/\\/variwiki.com","logo":{"@type":"ImageObject","url":"https:\\/\\/variwiki.com\\/resources\\/assets\\/wiki.png","caption":"Variscite Wiki"}},"potentialAction":{"@type":"SearchAction","target":"https:\\/\\/variwiki.com\\/index.php?title=Special:Search&search={search\_term}","query-input":"required name=search\_term"}}

*   [Log in](/index.php?title=Special:UserLogin&returnto=Wifi+NetworkManager "You are encouraged to log in; however, it is not mandatory [o]")

[![Variscite Wiki](/resources/assets/wiki.png)](/ "Visit the main page")

*   [Products](#)

[Customer Portal](/index.php?title=Customer_Portal)

[Contact Sales](https://www.variscite.com/contact-us/)

[Variscite Website](https://variscite.com)

[Page history](https://variwiki.com/index.php?title=Wifi_NetworkManager&action=history)

*   [Models by Processor](#)
    *   [NXP iMX8](#)
        *   [VAR-SOM-MX8M-PLUS](/index.php?title=VAR-SOM-MX8M-PLUS)
        *   [DART-MX8M-PLUS](/index.php?title=DART-MX8M-PLUS)
        *   [VAR-SOM-MX8M-NANO](/index.php?title=VAR-SOM-MX8M-NANO)
        *   [DART-MX8M-MINI](/index.php?title=DART-MX8M-MINI)
        *   [VAR-SOM-MX8M-MINI](/index.php?title=VAR-SOM-MX8M-MINI)
        *   [VAR-SOM-MX8](/index.php?title=VAR-SOM-MX8)
        *   [VAR-SOM-MX8X](/index.php?title=VAR-SOM-MX8X)
        *   [DART-MX8M](/index.php?title=DART-MX8M)
        *   [SPEAR-MX8](/index.php?title=SPEAR-MX8)
    *   [NXP iMX6](#)
        *   [VAR-SOM-6UL](/index.php?title=VAR-SOM-6UL)
        *   [DART-6UL](/index.php?title=DART-6UL)
        *   [VAR-SOM-SOLO/DUAL](/index.php?title=VAR-SOM-SOLO/DUAL)
        *   [DART-MX6](/index.php?title=DART-MX6)
        *   [VAR-SOM-MX6](/index.php?title=VAR-SOM-MX6)
    *   [NXP iMX7](#)
        *   [VAR-SOM-MX7](/index.php?title=VAR-SOM-MX7)
    *   [Qualcomm Snapdragon 410](#)
        *   [DART-SD410](/index.php?title=DART-SD410)
    *   [TI AM437x](#)
        *   [VAR-SOM-AM43](/index.php?title=VAR-SOM-AM43)
    *   [TI AM335x](#)
        *   [VAR-SOM-AM33](/index.php?title=VAR-SOM-AM33)
*   [Models by Architecture](#)
    *   [Cortex-A72](#)
        *   [SPEAR-MX8](/index.php?title=SPEAR-MX8)
        *   [VAR-SOM-MX8](/index.php?title=VAR-SOM-MX8)
    *   [Cortex-A53](#)
        *   [VAR-SOM-MX8M-PLUS](/index.php?title=VAR-SOM-MX8M-PLUS)
        *   [DART-MX8M-PLUS](/index.php?title=DART-MX8M-PLUS)
        *   [VAR-SOM-MX8M-NANO](/index.php?title=VAR-SOM-MX8M-NANO)
        *   [DART-MX8M-MINI](/index.php?title=DART-MX8M-MINI)
        *   [VAR-SOM-MX8M-MINI](/index.php?title=VAR-SOM-MX8M-MINI)
        *   [DART-MX8M](/index.php?title=DART-MX8M)
        *   [DART-SD410](/index.php?title=DART-SD410)
    *   [Cortex-A35](#)
        *   [VAR-SOM-MX8X](/index.php?title=VAR-SOM-MX8X)
    *   [Cortex-A9](#)
        *   [DART-MX6](/index.php?title=DART-MX6)
        *   [VAR-SOM-SOLO/DUAL](/index.php?title=VAR-SOM-SOLO/DUAL)
        *   [VAR-SOM-MX6](/index.php?title=VAR-SOM-MX6)
        *   [VAR-SOM-AM43](/index.php?title=VAR-SOM-AM43)
        *   [VAR-SOM-OM44](/index.php?title=VAR-SOM-OM44)
        *   [DART-4460](/index.php?title=DART-4460)
    *   [Cortex-A7](#)
        *   [VAR-SOM-6UL](/index.php?title=VAR-SOM-6UL)
        *   [DART-6UL](/index.php?title=DART-6UL)
        *   [VAR-SOM-MX7](/index.php?title=VAR-SOM-MX7)
    *   [Cortex-A8](#)
        *   [VAR-SOM-AM33](/index.php?title=VAR-SOM-AM33)
        *   [VAR-SOM-OM37](/index.php?title=VAR-SOM-OM37)
        *   [VAR-SOM-OM35](/index.php?title=VAR-SOM-OM35)
        *   [VAR-SOM-AM35](/index.php?title=VAR-SOM-AM35)
    *   [ARM9](#)
        *   [VAR-SOM-MX25](/index.php?title=VAR-SOM-MX25)

Wifi NetworkManager
===================

From Variscite Wiki

Jump to:[navigation](#mw-navigation), [search](#p-search)

Wireless

Contents
--------

*   [1 Managing WiFi using NetworkManager](#Managing_WiFi_using_NetworkManager)
    *   [1.1 Enabling and disabling WiFi](#Enabling_and_disabling_WiFi)
    *   [1.2 Configuring WiFi Client](#Configuring_WiFi_Client)
        *   [1.2.1 Scanning for available WiFi APs](#Scanning_for_available_WiFi_APs)
        *   [1.2.2 Connecting to an open WiFi network](#Connecting_to_an_open_WiFi_network)
        *   [1.2.3 Connecting to a protected WiFi network](#Connecting_to_a_protected_WiFi_network)
        *   [1.2.4 Managing existing connections](#Managing_existing_connections)
    *   [1.3 Configuring WiFi Access Point](#Configuring_WiFi_Access_Point)
        *   [1.3.1 Disabling standalone dnsmasq service](#Disabling_standalone_dnsmasq_service)
        *   [1.3.2 Creating WiFi AP](#Creating_WiFi_AP)
        *   [1.3.3 Configuring DHCP subnet](#Configuring_DHCP_subnet)
        *   [1.3.4 Editing AP configuration file](#Editing_AP_configuration_file)
        *   [1.3.5 Managing existing connections](#Managing_existing_connections_2)
    *   [1.4 WiFi STA/AP concurrency](#WiFi_STA.2FAP_concurrency)
        *   [1.4.1 Notes](#Notes)
        *   [1.4.2 Limitations](#Limitations)
*   [2 Testing WiFi throughput](#Testing_WiFi_throughput)
*   [3 Configuring WiFi Regulatory Domain](#Configuring_WiFi_Regulatory_Domain)
*   [4 Note on DART-MX8M WiFi Initialization](#Note_on_DART-MX8M_WiFi_Initialization)

1 Managing WiFi using NetworkManager
====================================

NetworkManager is a program for providing detection and configuration for systems to automatically connect to network.  
NetworkManager's functionality can be useful for both wireless and wired networks.  
This guide describes how to use NetworkManager to configure wireless networks.

1.1 Enabling and disabling WiFi
-------------------------------

To check if WiFi is enabled by NetworkManager run

\# nmcli dev show wlan0

and check the GENERAL.STATE line. If WiFi is enabled, the state is either connected or disconnected. If WiFi is disabled the state is unavailable.

To enable WiFi run

\# nmcli radio wifi on

or if you need to disable it you can run

\# nmcli radio wifi off

1.2 Configuring WiFi Client
---------------------------

### 1.2.1 Scanning for available WiFi APs

If WiFi is enabled you can get the list of available APs by running

\# nmcli dev wifi list

### 1.2.2 Connecting to an open WiFi network

To connect to an open WiFi network run

\# nmcli dev wifi connect <SSID>

To connect to an open hidden WiFi network run

\# nmcli dev wifi connect <SSID> hidden yes

To check connection status run

\# nmcli con show <SSID>

To check WiFi device status run

\# nmcli dev show wlan0

### 1.2.3 Connecting to a protected WiFi network

To connect to a protected WiFi network run

\# nmcli dev wifi connect <SSID> password <password> ifname wlan0

To connect to a protected hidden WiFi network run

\# nmcli dev wifi connect <SSID> password <password> hidden yes ifname wlan0

To check connection status run

\# nmcli con show <SSID>

To check WiFi device status run

\# nmcli dev show wlan0

### 1.2.4 Managing existing connections

Once established, the connection is preserved across reboots unless deleted explicitly.

To show existing connections, run

\# nmcli con show

To disconnect from a WiFi network, run

\# nmcli con down <SSID>

To reconnect to a WiFi network, run

\# nmcli con up <SSID>

To permanently delete a connection, run

\# nmcli con delete <SSID>

1.3 Configuring WiFi Access Point
---------------------------------

NetworkManager can also be used to turn WiFi interface into Access Point.  
The benefit of using NetworkManager in this scenario is the complete automation of WiFi, DHCP server and NAT configuration.

### 1.3.1 Disabling standalone dnsmasq service

Dnsmasq is a lightweight DNS forwarder and DHCP server.  
By default dnsmasq runs as a standalone service and will conflict with dnsmasq instance launched by NetworkManager.  
To prevent the conflict, disable dnsmasq service by running the following commands:

\# systemctl disable dnsmasq
# systemctl stop dnsmasq

For NetworkManager to run dnsmasq as a local caching DNS server, edit/create /etc/NetworkManager/NetworkManager.conf and add the following

\[main\]
dns=dnsmasq

### 1.3.2 Creating WiFi AP

Use the following commands to create the initial AP setup

\# nmcli con add type wifi ifname wlan0 mode ap con-name <name> ssid <ssid>
# nmcli con modify <name> 802-11-wireless.band <band>
# nmcli con modify <name> 802-11-wireless.channel <channel>
# nmcli con modify <name> 802-11-wireless-security.key-mgmt <key-mgmt>
# nmcli con modify <name> 802-11-wireless-security.proto <proto>
# nmcli con modify <name> 802-11-wireless-security.group <group>
# nmcli con modify <name> 802-11-wireless-security.pairwise <pairwise>
# nmcli con modify <name> 802-11-wireless-security.psk <passphrase>
# nmcli con modify <name> ipv4.method shared
# nmcli con up <name>

For example, the following commands will create AP configuration named WIFI\_AP on interface wlan0, with SSID MY\_AP, 2.4GHz band, channel 1, WPA2-PSK security, CCMP encryption and passphrase 11223344

\# nmcli con add type wifi ifname wlan0 mode ap con-name WIFI\_AP ssid MY\_AP
# nmcli con modify WIFI\_AP 802-11-wireless.band bg
# nmcli con modify WIFI\_AP 802-11-wireless.channel 1
# nmcli con modify WIFI\_AP 802-11-wireless-security.key-mgmt wpa-psk
# nmcli con modify WIFI\_AP 802-11-wireless-security.proto rsn
# nmcli con modify WIFI\_AP 802-11-wireless-security.group ccmp
# nmcli con modify WIFI\_AP 802-11-wireless-security.pairwise ccmp
# nmcli con modify WIFI\_AP 802-11-wireless-security.psk 11223344
# nmcli con modify WIFI\_AP ipv4.method shared
# nmcli con up WIFI\_AP

If you are planning to use the 5 GHz band and channel 36, you can partially change the above commands as follow

...
# nmcli con modify WIFI\_AP 802-11-wireless.band a
# nmcli con modify WIFI\_AP 802-11-wireless.channel 36
...

The complete list of nmcli configuration parameters is described in [https://developer.gnome.org/NetworkManager/stable/ref-settings.html](https://developer.gnome.org/NetworkManager/stable/ref-settings.html)

### 1.3.3 Configuring DHCP subnet

By default 10.42.0.x/24 subnet is used by NetworkManager DHCP server, with 10.42.0.1 address assigned to AP itself. To modify it use the following command

\# nmcli con modify <name> ipv4.addr <ipaddress/prefix>

For example, the following command will set DHCP subnet to 192.168.5.x/24

\# nmcli con modify WIFI\_AP ipv4.addr 192.168.5.1/24

### 1.3.4 Editing AP configuration file

NetworkManager will create /etc/NetworkManager/system-connections/WIFI\_AP configuration file.  
In addition to executing nmcli commands one can also edit this file to modify the AP settings.  

For changes in configuration file to take effect, restart NetworkManager by running

\# systemctl NetworkManager restart

### 1.3.5 Managing existing connections

Once created, the AP configuration is preserved across reboots unless deleted explicitly.

To show existing connections, run

\# nmcli con show

To temporarily disable AP configuration, run

\# nmcli con down <name>

To enable AP configuration, run

\# nmcli con up <name>

To permanently delete AP configuration, run

\# nmcli con delete <name>

1.4 WiFi STA/AP concurrency
---------------------------

To get the WiFi module to work in concurrent AP-STA mode, a virtual wireless interface is required.

This can be achieved creating a virtual _wlan1_ interface, running

\# iw dev wlan0 interface add wlan1 type \_\_ap

STA setup can be managed simply following the steps described in [Configuring WiFi Client](/index.php?title=Wifi_NetworkManager#Configuring_WiFi_Client "Wifi NetworkManager") section.

AP setup can be managed following the steps described in [Configuring WiFi Access Point](/index.php?title=Wifi_NetworkManager#Configuring_WiFi_Access_Point "Wifi NetworkManager") section, but when creating the access point, be careful to use wlan1 instead of wlan0.

### 1.4.1 Notes

nmcli commands create a permanent setup, that does not require to be repeated at every boot.

However, the _iw_ command (used to create the virtual wlan1 interface) does not create permanent changes: we suggest to introduce it in the variscite-wifi script (located in /etc/wifi for latest releases), when checking for the wlan0 existance, something like

if \[ -d /sys/class/net/wlan0 \]; then
	\# create wlan1 interface
	iw dev wlan0 interface add wlan1 type \_\_ap
	return 0
else
	...

Also, in the same file, just before shutting down wlan0, you may want to delete this virtual interface, something like

...
\# delete wlan1 interface
iw dev wlan1 del
\# Down WIFI
wifi\_down
...

### 1.4.2 Limitations

By HW design, Sterling-LWB/LWB5 WiFi modules provide a single channel tuner.

AP-STA operations are possible, but the local AP channel is actually the one negotiated between the local client and the remote AP.

2 Testing WiFi throughput
=========================

Establish connection to WiFi network and use iperf3 tool on target and another host:

iperf3 server (on Target/Host):

\# iperf3 -s

iperf3 client (on Host/Target):

Run UDP test for 30 seconds
# iperf3 -c <IP\_ADDRESS\_OF\_IPERF\_SERVER> -t 30 -u -b 0

Run TCP test for 30 seconds
# iperf3 -c <IP\_ADDRESS\_OF\_IPERF\_SERVER> -t 30

3 Configuring WiFi Regulatory Domain
====================================

According the mounting option of the SoM in use, the kernel loads dedicated firmware files from the folder /lib/firmware/brcm:

mounting option

WiFi chip

firmware files

WB

[Sterling LWB](https://www.lairdconnect.com/wireless-modules/wifi-modules-bluetooth/sterling-lwb-24-ghz-wifi-module)

brcmfmac43430-sdio.bin / brcmfmac43430-sdio.txt

WBD

[Sterling LWB5](https://www.lairdconnect.com/wireless-modules/wifi-modules-bluetooth/sterling-lwb5-dual-band-wifi-module-bluetooth-42)

brcmfmac4339-sdio.bin / brcmfmac4339-sdio.txt

Each txt file contains the _ccode_ parameter selecting the regulatory domain.

Additionally, for Sterling LWB5 only, the _regrev_ parameter must change according the ccode (it's always zero for Sterling LWB).

By default, the BSP ships firmware configurations matching FCC Regulatory Domain, one of the most restrictive in terms of available channels.

For Sterling LWB5 and FCC you can read

ccode=US
regrev=911

The following table reports the valid options for ccode / regrev parameter.

regulatory  
authority

Sterling LWB

Sterling LWB5

ccode

regrev

ccode

regrev

[FCC](https://www.fcc.gov/)

US

0

US

911

[ETSI](https://www.etsi.org/)

EU

0

EU

116

[ISED](https://www.ic.gc.ca/)

US\*

0

CA

938

[MIC](https://www.soumu.go.jp/english/)

JP

0

JP

101

\* ISED for Sterling LWB is managed using _ccode=US_, it's not a typo.

4 Note on DART-MX8M WiFi Initialization
=======================================

WiFi is initialized by **/etc/wifi/variscite-wifi**. During initialization, the Linux device tree **model** property is read from **/sys/devices/soc0/machine** and is used to determine the Variscite SOM model and configure the SoM GPIO pins.

Additionally, on the DART-MX8M, the WiFi and the SD card share the same SDIO controller and therefore cannot be used simultaneously. The WiFi script looks for a "WIFI" sub-string to determine whether or not the WiFi device tree was selected.

Therefore, customers who choose to modify the Linux device tree **model** property should only append to the string provided by Variscite.

  

Retrieved from "[https://variwiki.com/index.php?title=Wifi\_NetworkManager&oldid=19479](https://variwiki.com/index.php?title=Wifi_NetworkManager&oldid=19479)"

[Categories](/index.php?title=Special:Categories "Special:Categories"):

*   [Yocto](/index.php?title=Category:Yocto "Category:Yocto")
*   [Debian](/index.php?title=Category:Debian "Category:Debian")
*   [DART-MX8M](/index.php?title=Category:DART-MX8M "Category:DART-MX8M")
*   [DART-MX8M-MINI](/index.php?title=Category:DART-MX8M-MINI "Category:DART-MX8M-MINI")
*   [DART-MX8M-PLUS](/index.php?title=Category:DART-MX8M-PLUS "Category:DART-MX8M-PLUS")

Latest SOM

[VAR-SOM-MX8M-PLUS](/index.php?title=VAR-SOM-MX8M-PLUS "VAR-SOM-MX8M-PLUS")

[DART-MX8M-PLUS](/index.php?title=DART-MX8M-PLUS "DART-MX8M-PLUS")

[VAR-SOM-MX8M-NANO](/index.php?title=VAR-SOM-MX8M-NANO "VAR-SOM-MX8M-NANO")

[VAR-SOM-MX8M-MINI](/index.php?title=VAR-SOM-MX8M-MINI "VAR-SOM-MX8M-MINI")

[DART-MX8M-MINI](/index.php?title=DART-MX8M-MINI "DART-MX8M-MINI")

[VAR-SOM-MX8](/index.php?title=VAR-SOM-MX8 "VAR-SOM-MX8")

[VAR-SOM-MX8X](/index.php?title=VAR-SOM-MX8X "VAR-SOM-MX8X")

Support

[Variscite Support Center](https://www.variscite.com/support/)

[Customer Portal](https://varisciteportal.axosoft.com/login)

[Product Longevity](https://www.variscite.com/product-longevity)

[Product Compliance Policy](https://www.variscite.com/compliance/)

[Variscite Website](https://www.variscite.com/)

[Variscite Training](https://www.variscite.com/services/training/)

This page was last edited on 1 March 2022, at 19:10.

© \[document.write(new Date().getFullYear())\] Varicscite. All rights reserved

[](https://www.youtube.com/c/VarisciteLtd)[](https://www.linkedin.com/company/variscite-ltd-/)[](https://www.facebook.com/pages/Variscite-Ltd/323442114434181)[](https://twitter.com/Variscite_Ltd)

$(document).ready(function() { $("table.bugzilla").dataTable({ "bJQueryUI": true })}); (RLQ=window.RLQ||\[\]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.158","walltime":"0.503","ppvisitednodes":{"value":2050,"limit":1000000},"postexpandincludesize":{"value":1649,"limit":4194304},"templateargumentsize":{"value":46,"limit":4194304},"expansiondepth":{"value":6,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":2305,"limit":5000000},"timingprofile":\["100.00% 8.679 1 -total"," 71.02% 6.164 1 Template:PageHeader"," 27.87% 2.419 1 Template:DocImage"," 27.09% 2.351 1 Template:WikiSEO-description-default"\]},"cachereport":{"timestamp":"20221109165447","ttl":0,"transientcontent":true}}});mw.config.set({"wgBackendResponseTime":653});});